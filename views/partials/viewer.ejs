<style>
* {
  box-sizing: border-box;
}

#gcodeViewerModal {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

#gcodeViewerContainer {
  overflow: hidden;
  overflow-y: auto;
  width: 100vw;
  height: 100vh;
  background: #1d1d1d79;
  border-radius: 8px;
  box-shadow: 5 5 32px #0000004b;
  backdrop-filter: blur(0px);
  -webkit-backdrop-filter: blur(0px);
}

.sim-controls-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 10px 0 10px;
}

.sim-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border: none;
  background: #222;
  color: #fff;
  transition: background 0.2s;
  cursor: pointer;
  padding: 0;
}

.sim-btn svg {
  width: 18px;
  height: 18px;
}

.sim-play { background: #2ecc4096; }
.sim-pause { background: #ffdd0096; }
.sim-stop { background: #ff3d36; }
.sim-exit { background: #00000023; margin-left: auto; }
.sim-btn:hover { filter: brightness(1.2); }

.sim-speed-label {
  color: #fff;
  margin-left: 20px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.gcode-line-info {
  position: absolute;
  top: 10px;
  left: 10px;
  color: #ffdc00;
  font-size: 1.1em;
  padding: 4px 16px;
  z-index: 30;
  font-family: 'Consolas', 'Monaco', monospace;
  max-width: 90vw;
  white-space: pre;
  text-align: center;
}

@media (max-width: 480px) {
  .sim-controls-bar {
    flex-direction: column;
    align-items: stretch;
    gap: 4px;
    padding: 8px;
  }

  .sim-speed-label {
    flex-direction: column;
    align-items: flex-start;
    font-size: 0.9em;
  }

  #simSpeedSlider {
    width: 100% !important;
  }

  #simProgressBar {
    bottom: 80px;
  }
}
</style>

<div id="gcodeViewerModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0, 0, 0, 0.548); z-index:2000; align-items:center; justify-content:center;">
  <div id="gcodeViewerContainer" class="gcodeViewerContainer">
    <div id="gcodeViewerStats" class="gcodeViewerStats" style="position:absolute; top:40px; left:10px; z-index:10;"></div>

    <div class="sim-controls-bar" style="position:absolute; top:0px; right:0px; z-index:10;">
      <button onclick="closeGcodeViewer()" title="Exit" class="sim-btn sim-exit">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M2 2L14 14M14 2L2 14" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="sim-controls-bar" style="position:absolute; bottom:10px; left:10px; width:calc(100% - 20px); z-index:10;">
      <button id="runSimulationBtn" title="Play" class="sim-btn sim-play">
        <svg id="runSimulationIcon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <polygon points="4,2 14,8 4,14" fill="#fff"/>
        </svg>
      </button>
      <button id="rewindSimulationBtn" title="Rewind" class="sim-btn sim-rewind">
        <svg id="rewindSimulationIcon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <polygon points="12,2 2,8 12,14" fill="#fff"/>
        </svg>
      </button>
      <button id="forwardSimulationBtn" title="Forward" class="sim-btn sim-forward">
        <svg id="forwardSimulationIcon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <polygon points="4,2 14,8 4,14" fill="#fff"/>
          <polygon points="8,2 18,8 8,14" fill="#fff"/>
        </svg>
      </button>
      <label class="sim-speed-label">
        <span>Speed:</span>
        <input id="simSpeedSlider" type="range" min="0.001" max="10" value="10" step="0.1" style="vertical-align:middle; width:300px;">
        <span id="simSpeedValue">50</span> <span id="simSpeedUnit">ms/step</span>
      </label>
    </div>
    <input id="simProgressBar" type="range" min="0" max="1000" value="0" step="1" style="position:absolute; bottom:40px; left:10px; width:calc(100% - 20px); z-index:10;">
    <div id="gcode3d" style="width:100%; height:100%;"></div>
    <div id="gcodeLineInfo" class="gcode-line-info" style="display:none;"></div>
  </div>
</div>